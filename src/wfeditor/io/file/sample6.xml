<?xml version="1.0" encoding="UTF-8"?>
<workflow>
  <meta>
    <wf-name>sample 4</wf-name>
    <wf-ver>1.4</wf-ver>
    <wf-format-ver>1.0</wf-format-ver>
  </meta>
  <jobs>
    <job>
      <name>create-dirs</name>
      <prog-exec-loc>mkdir</prog-exec-loc>
      <prog-args>
        <arg>~/sge/alignment</arg>
      </prog-args>
      <prog-opts>
        <opt>
          <flag>-p</flag>
          <val/>
        </opt>
      </prog-opts>
    </job>
    <job>
      <name>align-array</name>
      <prog-exec-loc>~/ngs/bowtie/bowtie-0.12.7/bowtie</prog-exec-loc>
      <prog-args>
        <arg>hg19</arg>
        <arg>~/ngs/reads/c20_reads/alignable/split_by_i/i_reads$SGE_TASK_ID.fasta</arg>
        <arg>~/sge/alignment/align$SGE_TASK_ID.sam</arg>
      </prog-args>
      <prog-opts>
        <opt>
          <flag>-S</flag>
          <val/>
        </opt>
        <opt>
          <flag>-f</flag>
          <val/>
        </opt>
      </prog-opts>
      <deps>
        <dep>create-dirs</dep>
      </deps>
      <array>
        <start>1</start>
        <end>5</end>
        <step>1</step>
        <index-var>$SGE_TASK_ID</index-var>
      </array>
    </job>
    <job>
      <name>sam->bam-array</name>
      <prog-exec-loc>~/ngs/samtools/samtools-0.1.18/samtools</prog-exec-loc>
      <prog-args>
        <arg>view</arg>
        <arg>~/sge/alignment/align$SGE_TASK_ID.sam</arg>
      </prog-args>
      <prog-opts>
        <opt>
          <flag>-S</flag>
          <val/>
        </opt>
        <opt>
          <flag>-b</flag>
          <val/>
        </opt>
        <opt>
          <flag>-o</flag>
          <val>~/sge/alignment/align$SGE_TASK_ID.bam</val>
        </opt>
      </prog-opts>
      <deps>
        <dep>align-array</dep>
      </deps>
      <array>
        <start>1</start>
        <end>5</end>
      </array>
    </job>
    <job>
      <name>merge</name>
      <prog-exec-loc>~/ngs/samtools/samtools-0.1.18/samtools</prog-exec-loc>
      <prog-args>
        <arg>merge</arg>
        <arg>~/sge/alignment/merged.bam</arg>
        <arg>~/sge/alignment/align1.bam</arg>
        <arg>~/sge/alignment/align2.bam</arg>
        <arg>~/sge/alignment/align3.bam</arg>
        <arg>~/sge/alignment/align4.bam</arg>
        <arg>~/sge/alignment/align5.bam</arg>
      </prog-args>
      <prog-opts/>
      <deps>
        <dep>sam->bam-array</dep>
      </deps>
    </job>
    <job>
      <name>add-read-group</name>
      <prog-name>Picard</prog-name>
      <prog-ver>1.66</prog-ver>
      <prog-exec-loc>/usr/bin/java</prog-exec-loc>
      <prog-exec-ver>1.7.0</prog-exec-ver>
      <prog-args>
        <arg>-jar</arg>
        <arg>~/ngs/picard/picard-tools-1.66/AddOrReplaceReadGroups.jar</arg>
        <arg>INPUT=~/sge/alignment/merged.bam</arg>
        <arg>OUTPUT=~/sge/alignment/merged-rg.bam</arg>
        <arg>RGLB=whatever</arg>
        <arg>RGPL=illumina</arg>
        <arg>RGPU=whatever</arg>
        <arg>RGSM=whatever</arg>
      </prog-args>
      <prog-opts/>
      <deps>
        <dep>merge</dep>
      </deps>
    </job>
    <job>
      <name>index-bam</name>
      <prog-name>SAMtools</prog-name>
      <prog-exec-loc>~/ngs/samtools/samtools-0.1.18/samtools</prog-exec-loc>
      <prog-args>
        <arg>index</arg>
        <arg>~/sge/alignment/merged-rg.bam</arg>
      </prog-args>
      <deps>
        <dep>add-read-group</dep>
      </deps>
    </job>
    <job>
      <name>variant-calling</name>
      <prog-name>GATK</prog-name>
      <prog-ver>1.5-31-gadad76b</prog-ver>
      <prog-exec-loc>/usr/bin/java</prog-exec-loc>
      <prog-exec-ver>1.7.0</prog-exec-ver>
      <prog-args>
        <arg>-jar</arg>
        <arg>~/ngs/gatk/GenomeAnalysisTK-1.5-31-gadad76b/GenomeAnalysisTK.jar</arg>
      </prog-args>
      <prog-opts>
        <opt>
          <flag>-T</flag>
          <val>UnifiedGenotyper</val>
        </opt>
        <opt>
          <flag>-R</flag>
          <val>~/ngs/hg19/chr20.fa</val>
        </opt>
        <opt>
          <flag>-I</flag>
          <val>~/sge/alignment/merged-rg.bam</val>
        </opt>
        <opt>
          <flag>-o</flag>
          <val>~/sge/alignment/snps.raw.vcf</val>
        </opt>
      </prog-opts>
      <deps>
        <dep>index-bam</dep>
      </deps>
    </job>
  </jobs>
</workflow>

